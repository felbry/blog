<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker 配置私有仓库 | Felbry's Blog</title>
    <meta name="description" content="个人博客">
    <meta name="generator" content="VitePress v1.2.3">
    <link rel="preload stylesheet" href="/blog/assets/style.CncxvCC0.css" as="style">
    
    <script type="module" src="/blog/assets/app.DKvbibl-.js"></script>
    <link rel="preload" href="/blog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/blog/assets/chunks/framework.CR3ACB_j.js">
    <link rel="modulepreload" href="/blog/assets/chunks/theme.eoczX_Hq.js">
    <link rel="modulepreload" href="/blog/assets/docker_private-registry.md.Bv3lJpkV.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8291ffa></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8291ffa> Skip to content </a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar has-sidebar top" data-v-7ad780c2 data-v-844edcde><div class="wrapper" data-v-844edcde><div class="container" data-v-844edcde><div class="title" data-v-844edcde><div class="VPNavBarTitle has-sidebar" data-v-844edcde data-v-0ad69264><a class="title" href="/blog/" data-v-0ad69264><!--[--><!--]--><!----><span data-v-0ad69264>Felbry&#39;s Blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-844edcde><div class="content-body" data-v-844edcde><!--[--><!--]--><div class="VPNavBarSearch search" data-v-844edcde><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-844edcde data-v-f732b5d0><span id="main-nav-aria-label" class="visually-hidden" data-v-f732b5d0>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/summary.html" tabindex="0" data-v-f732b5d0 data-v-08fbf4b6><!--[--><span data-v-08fbf4b6>技术</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/resource.html" tabindex="0" data-v-f732b5d0 data-v-08fbf4b6><!--[--><span data-v-08fbf4b6>资源整理</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-844edcde data-v-283b26e9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-283b26e9 data-v-7df97737 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-7df97737></span><span class="vpi-moon moon" data-v-7df97737></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-844edcde data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/felbry" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-358b6670><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-844edcde data-v-8e87c032 data-v-af5898d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-af5898d3><span class="vpi-more-horizontal icon" data-v-af5898d3></span></button><div class="menu" data-v-af5898d3><div class="VPMenu" data-v-af5898d3 data-v-e42ed9b3><!----><!--[--><!--[--><!----><div class="group" data-v-8e87c032><div class="item appearance" data-v-8e87c032><p class="label" data-v-8e87c032>Appearance</p><div class="appearance-action" data-v-8e87c032><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-8e87c032 data-v-7df97737 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-7df97737></span><span class="vpi-moon moon" data-v-7df97737></span><!--]--></span></span></button></div></div></div><div class="group" data-v-8e87c032><div class="item social-links" data-v-8e87c032><div class="VPSocialLinks social-links-list" data-v-8e87c032 data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/felbry" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-358b6670><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-844edcde data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-844edcde><div class="divider-line" data-v-844edcde></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2488c25a><span class="vpi-align-left menu-icon" data-v-2488c25a></span><span class="menu-text" data-v-2488c25a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-883964e0><button data-v-883964e0>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-d8b57b2d data-v-4871f9f5><div class="curtain" data-v-4871f9f5></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-4871f9f5><span class="visually-hidden" id="sidebar-aria-label" data-v-4871f9f5> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><!----><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/summary.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>简介</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>构建工具</h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/build-tools/vite-and-rollup-plugin.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Vite 和 Rollup 插件开发</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>Unix</h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/unix/env-install.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>环境安装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/unix/ssh.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>SSH</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/unix/nginx.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Nginx</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/unix/rsync.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>rsync</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>编辑器</h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/editor/zed.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Zed</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>团队管理</h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/team-management/git.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Git使用规范</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>1panel</h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/1panel/https.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>使用 1panel 申请/续签 HTTPS 证书</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/1panel/reverse-proxy.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>使用 1panel 创建 HTTPS 服务</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>SVG</h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/svg/base.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>SVG基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/svg/learn-stroke-and-dash.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>认识Stroke和Dash</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0 has-active" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>Docker</h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/docker/base.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Docker 入门</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/docker/private-registry.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Docker 配置私有仓库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/docker/temp.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Docker 草稿</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>Material Design v3</h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/material-design/dynamic-color-gen.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>动态生成颜色</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/material-design/color-roles.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>颜色角色</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/material-design/elevation.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>海拔</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/material-design/states.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>状态</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/material-design/motion.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>运动/动画</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>Strapi v5</h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/strapi/docker-start.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Docker 一个工程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/strapi/custom-api.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>自定义接口</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/strapi/throw-error.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>抛错</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/strapi/strapi-api.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>strapi.xxx</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/strapi/table.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>表相关</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><!----><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/vue-repl-playground.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>参考 Element Plus Demo 和 Vue SFC Playground 自定义预览组件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/nodejs-api.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Node.js 常用 API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/csp.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>CSP</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/mastergo/all.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Master Go</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/blog/taro.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Taro</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-sidebar has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>目录</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _blog_docker_private-registry" data-v-e6f2a212><div><h1 id="docker-配置私有仓库" tabindex="-1">Docker 配置私有仓库 <a class="header-anchor" href="#docker-配置私有仓库" aria-label="Permalink to &quot;Docker 配置私有仓库&quot;">​</a></h1><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>阿里云购买的 2 核 2GiB 的服务器，由于内存过小，构建比较大的镜像时机器就会卡死</p><p>可以通过在服务器配置私有仓库，本地打包再推送到私有仓库的形式</p><p>其实也可以本地打包镜像后，导出通过 rsync 等方式传到服务端，再由服务端的 docker daemon load 这个镜像文件。但这种方式没有推送 registry 快。如果镜像是 1g，每次都要推送 1g；而 registry 可以缓存 layer 提升后续的传输速度</p></div><h2 id="_1-安装启动-docker-registry" tabindex="-1">1. 安装启动 Docker Registry <a class="header-anchor" href="#_1-安装启动-docker-registry" aria-label="Permalink to &quot;1. 安装启动 Docker Registry&quot;">​</a></h2><p>略</p><h2 id="_2-测试-registry-服务是否正常" tabindex="-1">2. 测试 registry 服务是否正常 <a class="header-anchor" href="#_2-测试-registry-服务是否正常" aria-label="Permalink to &quot;2. 测试 registry 服务是否正常&quot;">​</a></h2><p>访问<code>http://&lt;ip&gt;:&lt;port&gt;/v2/_catalog</code>，一般会得到如下响应：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;repositories&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li><code>port</code>默认是<code>5000</code></li><li>记得配置服务器的安全组开放该端口</li></ul><h2 id="_3-构建推送第一个镜像" tabindex="-1">3. 构建推送第一个镜像 <a class="header-anchor" href="#_3-构建推送第一个镜像" aria-label="Permalink to &quot;3. 构建推送第一个镜像&quot;">​</a></h2><p>构建 <code>docker build -t &lt;ip&gt;:&lt;port&gt;/&lt;image-name&gt;</code>，tag 的组成参见：<a href="./base.html#给镜像打-tag">Docker 入门 - 给镜像打 Tag</a></p><p>推送 <code>docker push &lt;ip&gt;:&lt;port&gt;/&lt;image-name&gt;</code></p><p>此时访问<code>http://&lt;ip&gt;:&lt;port&gt;/v2/_catalog</code>，得到如下响应：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;repositories&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;image-name&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>一开始推送，会报如下错误：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> refers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> repository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [&lt;ip&gt;:&lt;port&gt;/&lt;image-name&gt;]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://&lt;ip&gt;:&lt;port&gt;/v2/&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gave</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HTTP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> response</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HTTPS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> client</span></span></code></pre></div><p>需要配置<code>daemon.json</code>，将私有仓库的地址追加进<code>insecure-registries</code>中（非 https 访问的可视为不安全的地址）</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;insecure-registries&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;&lt;ip&gt;:&lt;port&gt;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div></div><h2 id="_4-服务端运行镜像" tabindex="-1">4. 服务端运行镜像 <a class="header-anchor" href="#_4-服务端运行镜像" aria-label="Permalink to &quot;4. 服务端运行镜像&quot;">​</a></h2><p>提前做两个步骤：</p><ul><li>1panel - 容器 - 仓库，配置私有仓库地址（主要指定协议和用户名、密码，这样拉取时就不需要询问）</li><li>1panel - 容器 - 配置 - 私有仓库，它对应 <code>daemon.json</code> 中的 <code>insecure-registries</code></li></ul><p>任意位置创建<code>docker-compose.yaml</code>文件，<code>image</code>指定为<code>127.0.0.1:&lt;port&gt;/&lt;image-name&gt;</code>，然后执行<code>docker compose up</code></p><h2 id="_5-加入用户认证" tabindex="-1">5. 加入用户认证 <a class="header-anchor" href="#_5-加入用户认证" aria-label="Permalink to &quot;5. 加入用户认证&quot;">​</a></h2><p>按照<a href="https://distribution.github.io/distribution/about/deploying/#native-basic-auth" target="_blank" rel="noreferrer">Deploy a registry server -&gt; Native basic auth</a>的前两条警示，要实现用户名和密码登录，必须先配置 TLS。因为不能以明文来传递这些数据</p><h3 id="_5-1-配置-tls" tabindex="-1">5.1 配置 TLS <a class="header-anchor" href="#_5-1-配置-tls" aria-label="Permalink to &quot;5.1 配置 TLS&quot;">​</a></h3><p>根据<a href="https://distribution.github.io/distribution/about/deploying/#get-a-certificate" target="_blank" rel="noreferrer">Deploy a registry server -&gt; Get a certificate</a>的描述，我们需要做两步：</p><ol><li>获得证书，即<code>.crt</code>文件和<code>.key</code>文件</li><li>通过<code>docker run</code>运行容器，主要传递<code>REGISTRY_HTTP_TLS_CERTIFICATE</code>、<code>REGISTRY_HTTP_TLS_KEY</code>这俩变量</li></ol><p>这里参考<a href="./../1panel/https.html">使用 1panel 申请/续签 HTTPS 证书</a>和<a href="./../1panel/reverse-proxy.html">使用 1panel 创建 HTTPS 服务</a>做一个 https 代理即可。没有必要从 registry 层面配置</p><h3 id="_5-2-配置用户名、密码" tabindex="-1">5.2 配置用户名、密码 <a class="header-anchor" href="#_5-2-配置用户名、密码" aria-label="Permalink to &quot;5.2 配置用户名、密码&quot;">​</a></h3><p>前置条件：当前处于 docker registry 的编排目录<code>/opt/1panel/apps/docker-registry/docker-registry</code></p><p><img src="https://felbry.github.io/picx-images-hosting/image.5mntkyhexu.webp" alt="image"></p><p>此时运行：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --entrypoint</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> htpasswd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  httpd:2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Bbn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> testuser</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> testpassword</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auth/htpasswd</span></span></code></pre></div><p>生成一个<code>auth</code>文件夹，其下有个<code>htpasswd</code>文件，文件中有一个：用户名：testuser、密码：testpassword 的账号</p><p>这里不用<code>docker run</code>运行，而是编排的形式。因此参考<a href="https://distribution.github.io/distribution/about/deploying/#deploy-your-registry-using-a-compose-file" target="_blank" rel="noreferrer">Deploy your registry using a Compose file</a>，对 compose 文件增加如下内容：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark has-diff vp-code" tabindex="0"><code><span class="line diff add"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span></span>
<span class="line diff add"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  REGISTRY_AUTH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">htpasswd</span></span>
<span class="line diff add"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  REGISTRY_AUTH_HTPASSWD_PATH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/auth/htpasswd</span></span>
<span class="line diff add"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  REGISTRY_AUTH_HTPASSWD_REALM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Registry Realm</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line diff add"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./auth:/auth</span></span></code></pre></div><ul><li>由于把<code>auth</code>目录创建在了和 compose 文件同级的目录下，所以 volume 的挂载路径就是<code>./auth</code></li></ul><p>重启 compose，此时访问<code>https://&lt;domain-name&gt;/v2/_catalog</code>就需要输入账号密码了</p><p>如果尝试推送<code>docker push &lt;domain-name&gt;/&lt;image-name&gt;</code>，就会报<code>no basic auth credentials</code>的错误</p><h3 id="ps-不建议自签名证书方案" tabindex="-1">PS：不建议自签名证书方案 <a class="header-anchor" href="#ps-不建议自签名证书方案" aria-label="Permalink to &quot;PS：不建议自签名证书方案&quot;">​</a></h3><p>按照文档<a href="https://distribution.github.io/distribution/about/insecure/#use-self-signed-certificates" target="_blank" rel="noreferrer">Test an insecure registry - Use self-signed certificates</a>所述，你需要做：</p><ol><li>首先通过<code>openssl</code>生成一个自己的证书文件</li><li>重新运行 registry，指向证书文件</li><li>根据你的操作系统，配置 docker daemon 去信任该证书</li><li>[可选]使用身份认证时，某些 Docker 还要求信任操作系统级别的证书</li></ol><p>与其这样麻烦，在有域名的前提下，不如申请证书走正规配置，能省去 3、4 以及后续步骤</p><h2 id="附-配置-registry" tabindex="-1">附：<a href="https://distribution.github.io/distribution/about/configuration/" target="_blank" rel="noreferrer">配置 registry</a> <a class="header-anchor" href="#附-配置-registry" aria-label="Permalink to &quot;附：[配置 registry](https://distribution.github.io/distribution/about/configuration/)&quot;">​</a></h2><p>一种是部分配置，比如<code>REGISTRY_AUTH</code>、<code>REGISTRY_AUTH_HTPASSWD_PATH</code></p><p>一种是全量覆盖配置</p><p>文档里都有详尽说明</p><h2 id="其它" tabindex="-1">其它 <a class="header-anchor" href="#其它" aria-label="Permalink to &quot;其它&quot;">​</a></h2><p>也可以通过该方式实现镜像加速：<a href="https://www.wanpeng.life/2826.html" target="_blank" rel="noreferrer">https://www.wanpeng.life/2826.html</a></p></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-5941af80><!--[--><!--]--><div class="edit-info" data-v-5941af80><div class="edit-link" data-v-5941af80><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/felbry/blog/edit/main/docker/private-registry.md" target="_blank" rel="noreferrer" data-v-5941af80><!--[--><span class="vpi-square-pen edit-link-icon" data-v-5941af80></span> Edit this page<!--]--></a></div><div class="last-updated" data-v-5941af80><p class="VPLastUpdated" data-v-5941af80 data-v-19a7ae4e>Last updated: <time datetime="2024-11-07T09:32:36.000Z" data-v-19a7ae4e></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-5941af80><span class="visually-hidden" id="doc-footer-aria-label" data-v-5941af80>Pager</span><div class="pager" data-v-5941af80><a class="VPLink link pager-link prev" href="/blog/docker/base.html" data-v-5941af80><!--[--><span class="desc" data-v-5941af80>Previous page</span><span class="title" data-v-5941af80>Docker 入门</span><!--]--></a></div><div class="pager" data-v-5941af80><a class="VPLink link pager-link next" href="/blog/docker/temp.html" data-v-5941af80><!--[--><span class="desc" data-v-5941af80>Next page</span><span class="title" data-v-5941af80>Docker 草稿</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"1panel_reverse-proxy.md\":\"CltywskE\",\"index.md\":\"B09Rtqqq\",\"build-tools_vite-and-rollup-plugin.md\":\"C1m_MzpD\",\"material-design_color-roles.md\":\"DRSZsfqp\",\"1panel_https.md\":\"DoP6vPaD\",\"mastergo_all.md\":\"DDE3L4mB\",\"readme.md\":\"CykJwzW0\",\"editor_zed.md\":\"Bm31WFA6\",\"csp.md\":\"Cp8rCTyr\",\"unix_ssh.md\":\"DS-c6pmq\",\"material-design_elevation.md\":\"ll_35QlA\",\"material-design_dynamic-color-gen.md\":\"DUqZ_JCn\",\"docker_base.md\":\"eDUF70kG\",\"strapi_strapi-api.md\":\"DxZAf5WZ\",\"summary.md\":\"De2iWfw3\",\"strapi_throw-error.md\":\"D7pCAgOZ\",\"strapi_table.md\":\"CM_SDfnY\",\"svg_base.md\":\"BNUy5wir\",\"taro.md\":\"DPZ_KFDX\",\"team-management_git.md\":\"CWs3Ixrr\",\"svg_learn-stroke-and-dash.md\":\"GnGOr6gB\",\"unix_env-install.md\":\"fEA7UA1f\",\"docker_private-registry.md\":\"Bv3lJpkV\",\"material-design_states.md\":\"80rJk0zl\",\"docker_temp.md\":\"C6vT7pAQ\",\"unix_rsync.md\":\"ZzBhjuHm\",\"resource.md\":\"BUegQXQD\",\"strapi_custom-api.md\":\"0t7kdjOv\",\"unix_nginx.md\":\"Kzof09tj\",\"material-design_motion.md\":\"BxuqlfON\",\"strapi_docker-start.md\":\"BIXOffL9\",\"regexp.md\":\"ComGJPlG\",\"nodejs-api.md\":\"D5aYW_0_\",\"vue-repl-playground.md\":\"CqF3X9s1\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Felbry's Blog\",\"description\":\"个人博客\",\"base\":\"/blog/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"技术\",\"link\":\"/summary\"},{\"text\":\"资源整理\",\"link\":\"/resource\"}],\"outline\":{\"level\":[2,3],\"label\":\"目录\"},\"sidebar\":{\"/\":[{\"text\":\"简介\",\"link\":\"/summary\"},{\"text\":\"构建工具\",\"items\":[{\"text\":\"Vite 和 Rollup 插件开发\",\"link\":\"/build-tools/vite-and-rollup-plugin\"}]},{\"text\":\"Unix\",\"items\":[{\"text\":\"环境安装\",\"link\":\"/unix/env-install\"},{\"text\":\"SSH\",\"link\":\"/unix/ssh\"},{\"text\":\"Nginx\",\"link\":\"/unix/nginx\"},{\"text\":\"rsync\",\"link\":\"/unix/rsync\"}]},{\"text\":\"编辑器\",\"items\":[{\"text\":\"Zed\",\"link\":\"/editor/zed\"}]},{\"text\":\"团队管理\",\"items\":[{\"text\":\"Git使用规范\",\"link\":\"/team-management/git\"}]},{\"text\":\"1panel\",\"items\":[{\"text\":\"使用 1panel 申请/续签 HTTPS 证书\",\"link\":\"/1panel/https\"},{\"text\":\"使用 1panel 创建 HTTPS 服务\",\"link\":\"/1panel/reverse-proxy\"}]},{\"text\":\"SVG\",\"items\":[{\"text\":\"SVG基础\",\"link\":\"/svg/base\"},{\"text\":\"认识Stroke和Dash\",\"link\":\"/svg/learn-stroke-and-dash\"}]},{\"text\":\"Docker\",\"items\":[{\"text\":\"Docker 入门\",\"link\":\"/docker/base\"},{\"text\":\"Docker 配置私有仓库\",\"link\":\"/docker/private-registry\"},{\"text\":\"Docker 草稿\",\"link\":\"/docker/temp\"}]},{\"text\":\"Material Design v3\",\"items\":[{\"text\":\"动态生成颜色\",\"link\":\"/material-design/dynamic-color-gen\"},{\"text\":\"颜色角色\",\"link\":\"/material-design/color-roles\"},{\"text\":\"海拔\",\"link\":\"/material-design/elevation\"},{\"text\":\"状态\",\"link\":\"/material-design/states\"},{\"text\":\"运动/动画\",\"link\":\"/material-design/motion\"}]},{\"text\":\"Strapi v5\",\"items\":[{\"text\":\"Docker 一个工程\",\"link\":\"/strapi/docker-start\"},{\"text\":\"自定义接口\",\"link\":\"/strapi/custom-api\"},{\"text\":\"抛错\",\"link\":\"/strapi/throw-error\"},{\"text\":\"strapi.xxx\",\"link\":\"/strapi/strapi-api\"},{\"text\":\"表相关\",\"link\":\"/strapi/table\"}]},{\"text\":\"参考 Element Plus Demo 和 Vue SFC Playground 自定义预览组件\",\"link\":\"/vue-repl-playground\"},{\"text\":\"Node.js 常用 API\",\"link\":\"/nodejs-api\"},{\"text\":\"CSP\",\"link\":\"/csp\"},{\"text\":\"Master Go\",\"link\":\"/mastergo/all\"},{\"text\":\"Taro\",\"link\":\"/taro\"}]},\"lastUpdated\":true,\"editLink\":{\"pattern\":\"https://github.com/felbry/blog/edit/main/:path\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/felbry\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>