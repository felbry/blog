<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker 入门 | Felbry's Blog</title>
    <meta name="description" content="个人博客">
    <meta name="generator" content="VitePress v1.5.0">
    <link rel="preload stylesheet" href="/blog/assets/style.DT_tSi71.css" as="style">
    <link rel="preload stylesheet" href="/blog/vp-icons.css" as="style">
    
    <script type="module" src="/blog/assets/app.BsFEm-W7.js"></script>
    <link rel="preload" href="/blog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/blog/assets/chunks/theme.D4Eq5LQu.js">
    <link rel="modulepreload" href="/blog/assets/chunks/framework.07rp2gkU.js">
    <link rel="modulepreload" href="/blog/assets/docker_base.md.Dpd1nYhf.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8291ffa></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8291ffa> Skip to content </a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle has-sidebar" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/blog/" data-v-9f43907a><!--[--><!--]--><!----><span data-v-9f43907a>Felbry&#39;s Blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/summary.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>技术</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/resource.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>资源整理</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/felbry" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/felbry" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2488c25a><span class="vpi-align-left menu-icon" data-v-2488c25a></span><span class="menu-text" data-v-2488c25a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-883964e0><button data-v-883964e0>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-d8b57b2d data-v-42c4c606><div class="curtain" data-v-42c4c606></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-42c4c606><span class="visually-hidden" id="sidebar-aria-label" data-v-42c4c606> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><!----><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/summary.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>简介</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>微信小程序</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/miniprogram/native-vs-taro.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>原生 VS Taro</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/miniprogram/dev-handbook.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>微信小程序开发手册</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/miniprogram/dev-problem.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>开发遇到的问题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/miniprogram/taro.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Taro</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>构建工具</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/build-tools/vite-and-rollup-plugin.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Vite 和 Rollup 插件开发</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>Unix</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/unix/env-install.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>环境安装</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/unix/ssh.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>SSH</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/unix/nginx.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Nginx</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/unix/rsync.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>rsync</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>编辑器</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/editor/zed.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Zed</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>团队管理</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/team-management/git.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Git使用规范</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>1panel</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/1panel/https.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>使用 1panel 申请/续签 HTTPS 证书</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/1panel/reverse-proxy.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>使用 1panel 创建 HTTPS 服务</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>SVG</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/svg/base.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>SVG基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/svg/learn-stroke-and-dash.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>认识Stroke和Dash</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0 has-active" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>Docker</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/docker/base.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Docker 入门</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/docker/private-registry.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Docker 配置私有仓库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/docker/ref.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Docker 快速参考</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>Material Design v3</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/material-design/dynamic-color-gen.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>动态生成颜色</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/material-design/color-roles.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>颜色角色</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/material-design/elevation.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>海拔</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/material-design/states.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>状态</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/material-design/motion.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>运动/动画</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>Strapi v5</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/strapi/docker-start.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Docker 一个工程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/strapi/pre-setting.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>快速设置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/strapi/custom-api.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>创建/自定义接口</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/strapi/throw-error.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>抛错</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/strapi/strapi-api.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>strapi.xxx</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/strapi/table.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>表相关</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>uni-app</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/uni-app/webview-back.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>uni-app 使用 webview 自定义返回逻辑</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><!----><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/vue-repl-playground.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>参考 Element Plus Demo 和 Vue SFC Playground 自定义预览组件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/nodejs-api.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Node.js 常用 API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/csp.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>CSP</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/blog/mastergo/all.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Master Go</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-sidebar has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>目录</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _blog_docker_base" data-v-e6f2a212><div><h1 id="docker-入门" tabindex="-1">Docker 入门 <a class="header-anchor" href="#docker-入门" aria-label="Permalink to &quot;Docker 入门&quot;">​</a></h1><h2 id="编写-dockerfile" tabindex="-1"><a href="https://docs.docker.com/get-started/docker-concepts/building-images/writing-a-dockerfile/" target="_blank" rel="noreferrer">编写 Dockerfile</a> <a class="header-anchor" href="#编写-dockerfile" aria-label="Permalink to &quot;[编写 Dockerfile](https://docs.docker.com/get-started/docker-concepts/building-images/writing-a-dockerfile/)&quot;">​</a></h2><p><a href="https://docs.docker.com/reference/dockerfile/" target="_blank" rel="noreferrer">指令参考</a></p><ul><li><code>FROM &lt;IMAGE_NAME&gt;</code> 指定基础镜像，必须位于第一行，后面可以跟一个可选的镜像标签</li><li><code>WORKDIR &lt;PATH&gt;</code> 设置工作目录。（我觉得可以理解为<code>cd</code>）</li><li><a href="https://docs.docker.com/reference/dockerfile/#copy" target="_blank" rel="noreferrer"><code>COPY &lt;HOST_PATH&gt; &lt;IMAGE_PATH&gt;</code> <code>COPY &lt;src1&gt; &lt;src2&gt; &lt;src...&gt; &lt;dest&gt;</code></a> 复制文件或目录到镜像，支持相对路径和绝对路径。</li><li><code>RUN &lt;COMMAND&gt;</code> 运行一条命令</li><li><code>ENV &lt;NAME&gt; &lt;VALUE&gt;</code> 设置环境变量（适用于正在运行的容器）</li><li><code>EXPOSE &lt;PORT&gt;</code> 暴露端口，让外部可以访问</li><li><code>USER &lt;USER-OR-UID&gt;</code> 为后续指令设置用户</li><li><code>CMD [&quot;&lt;command&gt;&quot;, &quot;&lt;arg1&gt;&quot;]</code> 设置基于此镜像的容器运行时自动执行的命令。示例：<code>CMD [&quot;uvicorn&quot;, &quot;app.main:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8080&quot;]</code></li></ul><h2 id="常用命令" tabindex="-1">常用命令 <a class="header-anchor" href="#常用命令" aria-label="Permalink to &quot;常用命令&quot;">​</a></h2><p>本地保存 tar(上传)，远程加载</p><ul><li><code>docker save myapp:latest &gt; myapp.tar</code></li><li><code>docker load &lt; myapp.tar</code></li></ul><p>其它</p><ul><li><code>docker run &lt;IMAGE_NAME&gt;</code> 基于指定镜像创建运行一个容器</li><li><code>docker ps</code> 查看正在运行的容器。<code>-a</code> 包含停止的容器</li><li><code>docker stop &lt;the-container-id&gt;</code> 停止运行容器。<code>the-container-id</code>可以截取部分，保证唯一性即可。比如<code>a1f7a4bb3a27</code>简写为<code>a1f</code></li><li><code>docker image ls</code> 查看本地（已下载/已构建）镜像。简写<code>docker images</code></li><li><code>docker image history &lt;IMAGE_NAME&gt;</code> 查看该镜像每一 layer 信息</li><li><code>docker tag &lt;DOCKER_USERNAME&gt;/demo &lt;DOCKER_USERNAME&gt;/demo:1.0</code></li><li><code>docker push &lt;DOCKER_USERNAME&gt;/demo:1.0</code></li></ul><h2 id="架构和相关概念" tabindex="-1">架构和相关概念 <a class="header-anchor" href="#架构和相关概念" aria-label="Permalink to &quot;架构和相关概念&quot;">​</a></h2><p>采用 C/S 架构</p><p><img src="https://docs.docker.com/get-started/images/docker-architecture.webp" alt=""></p><h3 id="服务端-dockerd" tabindex="-1">服务端 <code>dockerd</code> <a class="header-anchor" href="#服务端-dockerd" aria-label="Permalink to &quot;服务端 `dockerd`&quot;">​</a></h3><p>Docker daemon，守护进程，一方面接收客户端的 API 请求，一方面管理 Docker 对象(images、containers、networks、volumes)</p><h3 id="客户端-docker" tabindex="-1">客户端 <code>docker</code> <a class="header-anchor" href="#客户端-docker" aria-label="Permalink to &quot;客户端 `docker`&quot;">​</a></h3><p><code>docker run</code>等命令都是由客户端发起的，客户端通过 API 调用服务端，由<code>dockerd</code>执行</p><p>客户端可以与多个服务端（守护进程）通信</p><h3 id="docker-desktop" tabindex="-1">Docker Desktop <a class="header-anchor" href="#docker-desktop" aria-label="Permalink to &quot;Docker Desktop&quot;">​</a></h3><p>包含了<code>dockerd</code>、<code>docker</code>、Docker Compose、Docker Content Trust、Kubernetes...</p><h3 id="docker-registries" tabindex="-1">Docker Registries <a class="header-anchor" href="#docker-registries" aria-label="Permalink to &quot;Docker Registries&quot;">​</a></h3><p>负责存储 Docker 镜像。Docker Hub 类比 <code>npmjs.com</code>，同理 registry 也可以配置为私有的</p><h3 id="docker-compose" tabindex="-1">Docker Compose <a class="header-anchor" href="#docker-compose" aria-label="Permalink to &quot;Docker Compose&quot;">​</a></h3><p>用于运行管理多个容器。</p><p>虽然可以通过<code>docker run</code>启动多个容器，但是马上就会遇到网络管理、连接网络以及清理工作等许多麻烦的事。使用 Docker Compose 这种声明式工具，只需要定义<code>compose.yml</code>文件，在其中定义所有容器及其配置即可</p><h3 id="docker-objects" tabindex="-1">Docker Objects <a class="header-anchor" href="#docker-objects" aria-label="Permalink to &quot;Docker Objects&quot;">​</a></h3><p>images、containers、networks、volumes、plugins 都可以叫 Docker objects</p><h3 id="images-镜像" tabindex="-1">images 镜像 <a class="header-anchor" href="#images-镜像" aria-label="Permalink to &quot;images 镜像&quot;">​</a></h3><p>镜像是用来 创建 container 的<strong>只读</strong>模板（包含运行容器所需的文件、库和配置）</p><p>通常一个镜像会基于其它镜像，并进行一些自定义。比如可以构建一个基于<code>ubuntu</code>镜像，并安装<code>Apache web server</code>和其它<code>application</code>，再附带<code>application</code>运行所需的详细配置的镜像</p><p>创建一个镜像：创建一个 Dockerfile，定义创建并运行它所需的步骤。（每条指令都会创建一个 layer，更改并重建镜像时，也只会重建已更改的 layer）</p><div class="info custom-block"><p class="custom-block-title"><a href="https://docs.docker.com/get-started/docker-concepts/the-basics/what-is-an-image/#explanation" target="_blank" rel="noreferrer">两大原则</a></p><ol><li><p>镜像不可变。镜像一旦创建就无法修改，只能<strong>创建一个新镜像</strong>或<strong>在其之上添加更改</strong></p></li><li><p>每个镜像由 layers 组成。每个 layer 代表一组添加、删除或修改文件的文件系统更改</p></li></ol></div><p><a href="https://docs.docker.com/get-started/docker-concepts/building-images/understanding-image-layers/" target="_blank" rel="noreferrer">了解 layer</a>：</p><ul><li><p>先通过一个示例，解释“每个 layer 代表一组添加、删除或修改文件的文件系统更改”：</p><p>创建一个镜像从零开始考虑：假设当前是一个纯净的 ubuntu 系统，什么东西都没有，极端点想，该磁盘只有一个空空的根目录：<code>/</code>，要让程序代码运行，需要配置若干环境</p><ul><li>第 1 layer，先添加基本命令和包管理工具（比如 apt）</li><li>第 2 layer，安装 Python 运行时和 pip</li><li>第 3 layer，复制应用程序运行所需的必要文件（比如 requirements.txt）</li><li>第 4 layer，通过 pip 安装应用程序的依赖</li><li>第 5 layer，复制应用程序源码</li></ul><p><img src="https://docs.docker.com/get-started/docker-concepts/building-images/images/container_image_layers.webp" alt=""></p><p>每组文件系统更改都抽象成 layer，便可以跨镜像复用。</p><p><img src="https://docs.docker.com/get-started/docker-concepts/building-images/images/container_image_layer_reuse.webp" alt=""></p><p>这样<code>Debian base</code>和<code>Python and pip</code>layer 就可以被多个镜像引用了，而不用构建多个</p></li><li><p>堆叠 layers</p><ol><li>每个 layer 下载后，被提取到主机文件系统上对应的目录里</li><li>每从镜像运行一个新容器时，会创建一个独立的、全新的<strong>联合文件系统(union filesystem)</strong>。该镜像的每个 layer 就基于这个 union filesystem 逐个操作</li><li>容器启动时，使用<code>chroot</code>将其环境根目录设置为 union filesystem 的位置</li></ol><p>PS：文档中提到 当创建 union filesystem 时，除了镜像 layers，还会创建一个目录为正在运行的容器服务。允许容器进行文件系统更改，同时也能保证原始图像层保持不变。（这和我上边理解的好像有些差异，我理解的是这个目录等于 union filesystem，后续结合实践再看看）</p></li><li><p>追加 layer 实操</p><p>先基于 ubuntu 镜像创建一个名为 base-container 的容器，<code>docker run --name=base-container -ti ubuntu</code></p><p>在容器中安装 Node.js <code>apt update &amp;&amp; apt install -y nodejs</code> （文件更改发生在该容器的 union filesystem 中）</p><p>将 base-container 容器 构建为新镜像 node-base <code>docker container commit -m &quot;Add node&quot; base-container node-base</code></p><p>[可选] 此时查看镜像 node-base 的历史，就会看到刚追加进的 layer</p><p>再基于 node-base 镜像创建一个名为 app-container 的容器，<code>docker run --name=app-container -ti node-base</code></p><p>在容器中创建一个 app.js 文件 <code>echo &#39;console.log(&quot;Hello from an app&quot;)&#39; &gt; app.js</code>（文件更改发生在该容器的 union filesystem 中）</p><p>将 app-container 容器构建为新镜像 sample-app <code>docker container commit -c &quot;CMD node app.js&quot; -m &quot;Add app&quot; app-container sample-app</code></p><p>[可选] 此时查看镜像 sample-app 的历史，就会看到刚追加进的 layer</p></li></ul><h3 id="containers-容器" tabindex="-1">containers 容器 <a class="header-anchor" href="#containers-容器" aria-label="Permalink to &quot;containers 容器&quot;">​</a></h3><p>容器是镜像的可运行实例</p><p>可以创建、启动/停止、移动或删除容器</p><p>可以将容器连接到一个或多个网络，为其附加存储</p><p>甚至可以根据容器当前状态创建一个新镜像</p><p><strong>隔离性</strong>：容器与其它容器、操作系统都有相对较好的隔离。当然也可以手动控制容器的网络、存储、与主机关系的隔离程度</p><p>容器的配置选项取决于创建和启动它时对应的镜像，如果<strong>删除容器，任何未存储在持久存储中的状态更改都会消失</strong></p><h2 id="使用容器进行开发" tabindex="-1">使用容器进行开发 <a class="header-anchor" href="#使用容器进行开发" aria-label="Permalink to &quot;使用容器进行开发&quot;">​</a></h2><p>克隆 Demo 工程：<code>git clone https://github.com/docker/getting-started-todo-app</code></p><p>在工程目录下执行<code>docker compose watch</code>，访问 <code>http://localhost</code></p><p>之后无论是修改前端还是后端代码，网站都是实时更新</p><div class="info custom-block"><p class="custom-block-title">总结</p><p>容器化环境提供了统一的开发环境，每个人无需安装 Node、MySQL 或其它依赖项。</p></div><h2 id="构建镜像" tabindex="-1">构建镜像 <a class="header-anchor" href="#构建镜像" aria-label="Permalink to &quot;构建镜像&quot;">​</a></h2><h3 id="给镜像打-tag" tabindex="-1">给镜像打 Tag <a class="header-anchor" href="#给镜像打-tag" aria-label="Permalink to &quot;给镜像打 Tag&quot;">​</a></h3><p>完整的 tag 格式是：<code>[HOST[:PORT_NUMBER]/]PATH[:TAG]</code></p><p><code>HOST</code>和<code>PORT_NUMBER</code>表示 register 地址，可以省略，默认是<code>docker.io</code></p><p><code>PATH</code>由<code>[NAMESPACE/]REPOSITORY</code>组成，通常<code>NAMESPACE</code>就是自己 Docker 的用户名或组织名，如果不指定，默认是<code>library</code>(Docker 官方镜像命名空间)</p><p><code>TAG</code>随便自定义，默认是<code>latest</code></p><p>示例：</p><ul><li><code>nginx</code> 等于<code>docker.io/library/nginx:latest</code></li><li><code>docker/welcome-to-docker</code> 等于<code>docker.io/docker/welcome-to-docker:latest</code></li><li><code>ghcr.io/dockersamples/visualizer:pr-311</code> 这是一个完整 tag，每个部分都包含</li></ul><p>构建期间打 tag：<code>docker build -t my-username/my-image .</code>，<strong>使用<code>-t</code>或<code>--tag</code></strong></p><p>构建后添加额外 tag：<code>docker image tag my-username/my-image another-username/another-image:v1</code>，<strong>使用<code>docker image tag ..</code></strong></p><h3 id="构建缓存" tabindex="-1">构建缓存 <a class="header-anchor" href="#构建缓存" aria-label="Permalink to &quot;构建缓存&quot;">​</a></h3><p>要想合理利用缓存，要知道哪些情况会让缓存失效：</p><ul><li><code>RUN</code>指令的任何更改</li><li><code>COPY</code>或<code>ADD</code>指令对应文件的任何更改（无论是内容还是权限更改）</li><li>一层失效，后续（可能是依赖？）层也失效</li></ul><p>以以下 Dockerfile 为例</p><div class="language-Dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:20-alpine</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . .</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> yarn install --production</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./src/index.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>根据以上指令，只要每次源文件更改，<code>yarn install</code>都会重新执行，浪费时间</p><p>更新后的 Dockerfile</p><div class="language-Dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:20-alpine</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> package.json yarn.lock ./</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> yarn install --production</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . .</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;src/index.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>先复制依赖文件，执行依赖安装，再进行所有源文件拷贝。只要<code>package.json</code>和<code>yarn.lock</code>没变化，就不会重复依赖安装</p><p>从构建日志中，通过<code>CACHED</code>关键字可以了解到哪些步骤缓存了</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 初次构建</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; [1/5] FROM docker.io/library/node:21-alpine                                                    0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [2/5] WORKDIR /app                                                                      0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; [3/5] COPY package.json yarn.lock ./                                                           0.2s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; [4/5] RUN yarn install --production                                                           14.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; [5/5] COPY </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 二次构建（使用缓存）</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; [1/5] FROM docker.io/library/node:21-alpine                                                    0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [2/5] WORKDIR /app                                                                      0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [3/5] COPY package.json yarn.lock ./                                                    0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [4/5] RUN yarn install --production                                                     0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; [5/5] COPY </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> .</span></span></code></pre></div><h3 id="构建并推送第一个镜像" tabindex="-1">构建并推送第一个镜像 <a class="header-anchor" href="#构建并推送第一个镜像" aria-label="Permalink to &quot;构建并推送第一个镜像&quot;">​</a></h3><p>先在<a href="https://hub.docker.com/" target="_blank" rel="noreferrer">Docker Hub</a>创建一个仓库，仓库名为 getting-started-todo-app</p><p>在项目根目录先构建：<code>docker build -t &lt;DOCKER_USERNAME&gt;/getting-started-todo-app .</code></p><p>然后运行<code>docker image ls</code>查看本地镜像是否构建成功</p><p>最后推送到远程：<code>docker push &lt;DOCKER_USERNAME&gt;/getting-started-todo-app</code></p><h3 id="多阶段构建" tabindex="-1">多阶段构建 <a class="header-anchor" href="#多阶段构建" aria-label="Permalink to &quot;多阶段构建&quot;">​</a></h3><p>如果不指定<code>--target</code>，Docker 默认构建最后一个阶段（即下面示例的<code>final</code>）为输出镜像</p><p>因此可以在之前的阶段做构建，最后阶段仅包含运行时所需文件</p><div class="language-Dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eclipse-temurin:21.0.2_13-jdk-jammy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /opt/app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .mvn/ .mvn</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mvnw pom.xml ./</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ./mvnw dependency:go-offline</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ./src ./src</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ./mvnw clean install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eclipse-temurin:21.0.2_13-jre-jammy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> final</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /opt/app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 8080</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=builder /opt/app/target/*.jar /opt/app/*.jar</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENTRYPOINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;java&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-jar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/opt/app/*.jar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>要点：</p><ol><li><code>AS</code> 给阶段命名，方便后续引用</li><li><code>COPY --from=builder</code> 从 builder 阶段拷贝文件</li></ol><h2 id="运行容器" tabindex="-1">运行容器 <a class="header-anchor" href="#运行容器" aria-label="Permalink to &quot;运行容器&quot;">​</a></h2><h3 id="发布和公开端口" tabindex="-1">发布和公开端口 <a class="header-anchor" href="#发布和公开端口" aria-label="Permalink to &quot;发布和公开端口&quot;">​</a></h3><p>容器运行时，通过<code>docker run -d -p HOST_PORT:CONTAINER_PORT nginx</code>将主机端口与容器端口做映射</p><p>比如<code>docker run -d -p 8080:80 nginx</code>，那访问主机<code>http://localhost:8080</code>就会转发到容器的<code>80</code>端口上</p><p>如果主机的 8080 此时被占用 或 随便哪个主机端口都行，可以省略<code>HOST_PORT:</code>，即：<code>docker run -p 80 nginx</code></p><p>此时运行<code>docker ps</code>，就能看到实际映射的主机端口为<code>54772</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CONTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         COMMAND</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          PORTS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    NAMES</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">a527355c9c53</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         &quot;/docker-entrypoint.â¦&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> seconds</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ago</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> seconds</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    0.0.0.0:54772</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">80/tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    romantic_williamson</span></span></code></pre></div><p>Dockerfile 中的<code>EXPOSE</code>指定应用程序运行将使用的（容器）端口。可以通过<code>-P</code>或<code>--publish-all</code>将所有指定(公开)端口发布到随机(临时)端口上。比如先<code>docker run -P nginx</code>，然后<code>docker ps</code>看看发布到了哪个端口上</p><h3 id="覆盖容器默认值" tabindex="-1">覆盖容器默认值 <a class="header-anchor" href="#覆盖容器默认值" aria-label="Permalink to &quot;覆盖容器默认值&quot;">​</a></h3><p>通过<code>docker run</code>传参的形式覆盖默认值</p><ul><li><p>覆盖网络端口</p><p><code>docker run -d -p HOST_PORT:CONTAINER_PORT postgres</code></p></li><li><p>设置环境变量</p><p><code>docker run -e foo=bar postgres env</code>，在容器内设置一个 foo 的环境变量，其值为 bar</p><p>如果变量多，可以用<code>.env</code>文件，<code>docker run --env-file .env postgres env</code></p></li><li><p>限制容器消耗资源</p><p>使用<code>--memory</code>和<code>--cpus</code>，<code>docker run -e POSTGRES_PASSWORD=secret --memory=&quot;512m&quot; --cpus=&quot;0.5&quot; postgres</code></p></li></ul><p>通过<code>compose.yaml</code>覆盖默认值</p><ul><li>CMD 或 ENTRYPOINT</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  postgres</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    entrypoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;docker-entrypoint.sh&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;postgres&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;-h&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;localhost&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;-p&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;5432&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h3 id="控制网络" tabindex="-1">控制网络 <a class="header-anchor" href="#控制网络" aria-label="Permalink to &quot;控制网络&quot;">​</a></h3><p>默认情况，所有容器运行时会自动连接到一个桥接网络，它允许同一主机上的容器相互通信，同时也与外界和其它主机隔离</p><p>如果想某个容器与该主机上的其它容器网络隔离，可以自定义网络</p><p>先创建个网络：<code>docker network create mynetwork</code>，查看所有网络：<code>docker network ls</code>，</p><p>连接自定义网络：<code>docker run -d -e POSTGRES_PASSWORD=secret -p 5434:5432 --network mynetwork postgres</code></p><p>查看是否连接成功：<code>docker network inspect</code></p><p>默认网桥与自定义网络主要区别在<strong>DNS 解析方式</strong>：连接到默认网桥所有容器只能通过 IP 地址通信（除非用<code>--link</code>，但这个选项过时了）；自定义网络上的容器通过名称或别名解析。只有附加到自定义网络上的容器才能相互通信</p><h3 id="持久化容器数据-volume" tabindex="-1">持久化容器数据 volume <a class="header-anchor" href="#持久化容器数据-volume" aria-label="Permalink to &quot;持久化容器数据 volume&quot;">​</a></h3><p><code>docker run -d -p 80:80 -v log-data:/logs docker/welcome-to-docker</code></p><p>容器写入<code>/logs</code>的内容会持久存储在<code>log-data</code>（如果不存在，会自动创建）这个 volume 里</p><p>删除容器，并使用该 volume 启动新容器，文件仍可用</p><p>可将同一 volume 附加到多个容器以在它们之间共享文件（日志聚合、数据管道或其它事件驱动等场景）</p><h3 id="与容器共享本地文件" tabindex="-1">与容器共享本地文件 <a class="header-anchor" href="#与容器共享本地文件" aria-label="Permalink to &quot;与容器共享本地文件&quot;">​</a></h3><p>主机与容器之间保存和共享文件有两种形式，一是 volume，二是 bind mounts</p><p>如果想<strong>持久存储</strong>容器内生成或修改的数据（即使容器停止或删除），选择 volume。最典型的就是数据库</p><p>如果想主机和容器之间<strong>实时文件访问</strong>，选择 bind mounts。比如配置文件，实时构建产物（热更新）</p><p>与<code>-v</code>相比，<code>--mount</code>提供更高级功能和粒度控制</p><p><code>docker run --mount type=bind,source=/HOST/PATH,target=/CONTAINER/PATH,readonly nginx</code></p><p><code>docker run --mount type=volume,src=/HOST/PATH,target=/CONTAINER/PATH nginx</code></p><p><code>docker run -v HOST-DIRECTORY:/CONTAINER-DIRECTORY:rw nginx</code>，<code>:rw</code>是读写，<code>:ro</code>是只读，可以与<code>-v</code>和<code>--mount</code>一起使用</p><p>仅与容器共享需要的目录。文件共享会带来开销，因为主机上文件的任何更改都需要通知 Linux VM。共享太多文件可能会导致 CPU 负载过高和文件系统性能下降</p><p>对于缓存目录或数据库等非代码项，使用 data volume，性能会好得多</p><h2 id="问题" tabindex="-1">问题 <a class="header-anchor" href="#问题" aria-label="Permalink to &quot;问题&quot;">​</a></h2><ol><li><code>Error response from daemon: Get &quot;https://registry-1.docker.io/v2/&quot;</code></li></ol><p>外网的 docker hub 访问不通，通过配置 daemon 代理访问。</p><ul><li><p>方式 1：（推荐）</p><p><img src="https://felbry.github.io/picx-images-hosting/image.3yeg55fyks.webp" alt="image"></p></li><li><p>方式 2：参考<a href="https://docs.docker.com/reference/cli/dockerd/#daemon-configuration-file" target="_blank" rel="noreferrer">daemon configuration file</a>、<a href="https://docs.docker.com/engine/daemon/proxy/#httphttps-proxy" target="_blank" rel="noreferrer">http/https proxy</a></p><p>mac 版配置如图：（参考<a href="https://s.v2ex.com/t/1056546#r_14982082" target="_blank" rel="noreferrer">请问大佬， MacOS 下如何设置 docker 使用本地代理？ - v2ex</a>）</p><p><img src="https://felbry.github.io/picx-images-hosting/image.9rje8kv6hg.webp" alt="image"></p></li></ul><ol start="2"><li><code>ERROR [client internal] load metadata for docker.io/library/node:20</code></li></ol><p>在按照官网教程操作<a href="#使用容器进行开发">使用容器进行开发</a>时，报了这个错误，完整情况如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> watch</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[+] Building 31.2s (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">4/4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) FINISHED                                         docker:desktop-linux</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; [backend </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">internal]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> load</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> definition</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Dockerfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                              0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dockerfile:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 3.30kB</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                                    0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; [client </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">internal]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> load</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> definition</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Dockerfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                               0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dockerfile:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 3.30kB</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                                    0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ERROR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [client </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">internal]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> load</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metadata</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker.io/library/node:20</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  31.1s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; [backend </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">auth]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> library/node:pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> token</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry-1.docker.io</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                       0.0s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">------</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [client internal] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">load</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metadata</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker.io/library/node:20:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">failed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> solve:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DeadlineExceeded:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DeadlineExceeded:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DeadlineExceeded:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node:20:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> failed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> resolve</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metadata</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker.io/library/node:20:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> failed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> authorize:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DeadlineExceeded:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> failed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fetch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> oauth</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> token:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Post</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://auth.docker.io/token&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dial</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 108.160.172.204:443:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> i/o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> timeout</span></span></code></pre></div><p>相关 issue：</p><ul><li><a href="https://github.com/docker/buildx/issues/1979" target="_blank" rel="noreferrer">Docker Desktop proxy not being recognized when doing a build. #1979</a></li><li><a href="https://github.com/docker/buildx/pull/1487" target="_blank" rel="noreferrer">add system proxy config support for cli requests</a></li></ul><p>大概意思是 build 过程会在 CLI 中直接访问<code>*.docker.io</code>的资源，如果仅仅是 daemon 设置了代理，而终端没有设置代理，就请求不通</p><p>临时解决方法就是在终端中设置 HTTP_PROXY 和 HTTPS_PROXY(不区分大小写)，设置完后再 build</p></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><div class="edit-info" data-v-1bcd8184><div class="edit-link" data-v-1bcd8184><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/felbry/blog/edit/main/docker/base.md" target="_blank" rel="noreferrer" data-v-1bcd8184><!--[--><span class="vpi-square-pen edit-link-icon" data-v-1bcd8184></span> Edit this page<!--]--></a></div><div class="last-updated" data-v-1bcd8184><p class="VPLastUpdated" data-v-1bcd8184 data-v-1bb0c8a8>Last updated: <time datetime="2024-10-31T06:32:02.000Z" data-v-1bb0c8a8></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/blog/svg/learn-stroke-and-dash.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Previous page</span><span class="title" data-v-1bcd8184>认识Stroke和Dash</span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/blog/docker/private-registry.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Next page</span><span class="title" data-v-1bcd8184>Docker 配置私有仓库</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"1panel_https.md\":\"CY0Gz0OW\",\"1panel_reverse-proxy.md\":\"CFNDXXGw\",\"build-tools_vite-and-rollup-plugin.md\":\"8gMnsxTv\",\"csp.md\":\"CsY_rTN7\",\"docker_base.md\":\"Dpd1nYhf\",\"docker_private-registry.md\":\"CKbQ5ua8\",\"docker_ref.md\":\"BjbIZSaN\",\"editor_zed.md\":\"CSRZ2Yfc\",\"index.md\":\"BtG-mRdP\",\"mastergo_all.md\":\"Ckkxb2FB\",\"material-design_color-roles.md\":\"CUTNtq0N\",\"material-design_dynamic-color-gen.md\":\"BN5PAAPC\",\"material-design_elevation.md\":\"DVnmM-4R\",\"material-design_motion.md\":\"DlI12fLG\",\"material-design_states.md\":\"DmbBTGpr\",\"miniprogram_dev-handbook.md\":\"BpbrBDlt\",\"miniprogram_dev-problem.md\":\"Bo2aw2mj\",\"miniprogram_native-vs-taro.md\":\"OB-w8ptN\",\"miniprogram_taro.md\":\"CwJSJjEe\",\"nodejs-api.md\":\"yT-HxzQw\",\"readme.md\":\"BF6emAVM\",\"regexp.md\":\"vabtQ8XP\",\"resource.md\":\"DWZ6nNxV\",\"strapi_custom-api.md\":\"CVkyMLoS\",\"strapi_docker-start.md\":\"XDDUeT4m\",\"strapi_pre-setting.md\":\"BNA1qiFV\",\"strapi_strapi-api.md\":\"BMRVdH4K\",\"strapi_table.md\":\"Shyn8rF5\",\"strapi_throw-error.md\":\"CNChfuSd\",\"summary.md\":\"BA2NDhs_\",\"svg_base.md\":\"Svgd1oQ8\",\"svg_learn-stroke-and-dash.md\":\"Cq-yYvM5\",\"team-management_git.md\":\"CVOjI_6C\",\"uni-app_webview-back.md\":\"Kb1QX5X0\",\"unix_env-install.md\":\"Cgmo5mZ9\",\"unix_nginx.md\":\"C55om8Z-\",\"unix_rsync.md\":\"s5nw2ReZ\",\"unix_ssh.md\":\"Bw9wh4b5\",\"vue-repl-playground.md\":\"CTGAGGQz\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Felbry's Blog\",\"description\":\"个人博客\",\"base\":\"/blog/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"技术\",\"link\":\"/summary\"},{\"text\":\"资源整理\",\"link\":\"/resource\"}],\"outline\":{\"level\":[2,3],\"label\":\"目录\"},\"sidebar\":{\"/\":[{\"text\":\"简介\",\"link\":\"/summary\"},{\"text\":\"微信小程序\",\"items\":[{\"text\":\"原生 VS Taro\",\"link\":\"/miniprogram/native-vs-taro\"},{\"text\":\"微信小程序开发手册\",\"link\":\"/miniprogram/dev-handbook\"},{\"text\":\"开发遇到的问题\",\"link\":\"/miniprogram/dev-problem\"},{\"text\":\"Taro\",\"link\":\"/miniprogram/taro\"}]},{\"text\":\"构建工具\",\"items\":[{\"text\":\"Vite 和 Rollup 插件开发\",\"link\":\"/build-tools/vite-and-rollup-plugin\"}]},{\"text\":\"Unix\",\"items\":[{\"text\":\"环境安装\",\"link\":\"/unix/env-install\"},{\"text\":\"SSH\",\"link\":\"/unix/ssh\"},{\"text\":\"Nginx\",\"link\":\"/unix/nginx\"},{\"text\":\"rsync\",\"link\":\"/unix/rsync\"}]},{\"text\":\"编辑器\",\"items\":[{\"text\":\"Zed\",\"link\":\"/editor/zed\"}]},{\"text\":\"团队管理\",\"items\":[{\"text\":\"Git使用规范\",\"link\":\"/team-management/git\"}]},{\"text\":\"1panel\",\"items\":[{\"text\":\"使用 1panel 申请/续签 HTTPS 证书\",\"link\":\"/1panel/https\"},{\"text\":\"使用 1panel 创建 HTTPS 服务\",\"link\":\"/1panel/reverse-proxy\"}]},{\"text\":\"SVG\",\"items\":[{\"text\":\"SVG基础\",\"link\":\"/svg/base\"},{\"text\":\"认识Stroke和Dash\",\"link\":\"/svg/learn-stroke-and-dash\"}]},{\"text\":\"Docker\",\"items\":[{\"text\":\"Docker 入门\",\"link\":\"/docker/base\"},{\"text\":\"Docker 配置私有仓库\",\"link\":\"/docker/private-registry\"},{\"text\":\"Docker 快速参考\",\"link\":\"/docker/ref\"}]},{\"text\":\"Material Design v3\",\"items\":[{\"text\":\"动态生成颜色\",\"link\":\"/material-design/dynamic-color-gen\"},{\"text\":\"颜色角色\",\"link\":\"/material-design/color-roles\"},{\"text\":\"海拔\",\"link\":\"/material-design/elevation\"},{\"text\":\"状态\",\"link\":\"/material-design/states\"},{\"text\":\"运动/动画\",\"link\":\"/material-design/motion\"}]},{\"text\":\"Strapi v5\",\"items\":[{\"text\":\"Docker 一个工程\",\"link\":\"/strapi/docker-start\"},{\"text\":\"快速设置\",\"link\":\"/strapi/pre-setting\"},{\"text\":\"创建/自定义接口\",\"link\":\"/strapi/custom-api\"},{\"text\":\"抛错\",\"link\":\"/strapi/throw-error\"},{\"text\":\"strapi.xxx\",\"link\":\"/strapi/strapi-api\"},{\"text\":\"表相关\",\"link\":\"/strapi/table\"}]},{\"text\":\"uni-app\",\"items\":[{\"text\":\"uni-app 使用 webview 自定义返回逻辑\",\"link\":\"/uni-app/webview-back\"}]},{\"text\":\"参考 Element Plus Demo 和 Vue SFC Playground 自定义预览组件\",\"link\":\"/vue-repl-playground\"},{\"text\":\"Node.js 常用 API\",\"link\":\"/nodejs-api\"},{\"text\":\"CSP\",\"link\":\"/csp\"},{\"text\":\"Master Go\",\"link\":\"/mastergo/all\"}]},\"lastUpdated\":true,\"editLink\":{\"pattern\":\"https://github.com/felbry/blog/edit/main/:path\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/felbry\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>